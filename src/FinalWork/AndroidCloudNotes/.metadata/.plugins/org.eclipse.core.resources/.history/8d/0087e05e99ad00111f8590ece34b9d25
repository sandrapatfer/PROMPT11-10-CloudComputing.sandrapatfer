package prompt.cloudnotes.stores;

import java.util.Iterator;
import java.util.List;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.atomic.AtomicReference;

import prompt.cloudnotes.model.TaskList;

public class TaskListStore implements Iterable<TaskList> {

	private AtomicReference<ConcurrentHashMap<Long, TaskList>> _store;

	public TaskListStore() {
		_store = new AtomicReference<ConcurrentHashMap<Long, TaskList>>();
		_store.set(new ConcurrentHashMap<Long, TaskList>());
	}
	
	public Iterator<TaskList> iterator() {
		return _store.get().values().iterator();
	}

	public TaskList get(long id) {
		return _store.get().get(id);
	}
	
	public void add(List<TaskList> list) {		
		// just replace the whole list
		ConcurrentHashMap<Long, TaskList> newStore = new ConcurrentHashMap<Long, TaskList>();
		for (TaskList l : list) {
			newStore.put((long) l.getId(), l);
		}
		_store.set(newStore);
	}	
}
