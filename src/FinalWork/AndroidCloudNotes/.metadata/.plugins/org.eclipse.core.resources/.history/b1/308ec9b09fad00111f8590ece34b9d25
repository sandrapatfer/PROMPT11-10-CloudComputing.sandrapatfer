package prompt.cloudnotes.activities;

import prompt.cloudnotes.CloudNotesApp;
import prompt.cloudnotes.R;
import prompt.cloudnotes.providers.TaskListProviderContract;
import android.app.Activity;
import android.content.Context;
import android.database.Cursor;
import android.net.Uri;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.CursorAdapter;
import android.widget.TextView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ListView;

public class AndroidCloudNotesActivity extends Activity
{
	private Cursor _cursor;

	/** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState)
    {
        super.onCreate(savedInstanceState);
        
        Log.d(CloudNotesApp.TAG, "AndroidCloudNotesActivity.onCreate");
        
        setContentView(R.layout.tasklist_view);
        ListView listView = (ListView)findViewById(R.id.tasklist_view);
        listView.setOnItemClickListener(new OnItemClickListener()
        {
			public void onItemClick(AdapterView<?> parent, View view, int position, long id)
			{
				Log.d(CloudNotesApp.TAG, "AndroidCloudNotesActivity.onItemClick");

			}
		});
        
        _cursor = getContentResolver().query(Uri.parse(TaskListProviderContract.URI), 
        		new String[] { "id", "name"}, 
        		null, null, null);
        startManagingCursor(_cursor);
        
        final TaskListAdapter adapter = new TaskListAdapter(this, _cursor);
        listView.setAdapter(adapter);

    }
    
    private class TaskListAdapter extends CursorAdapter {
    	
    	public TaskListAdapter(Context context, Cursor cursor) {
    		super(context, cursor);
    	}

    	@Override
    	public void bindView(View view, Context context, Cursor cursor) {
    		int colIndex = cursor.getColumnIndex("name");
    		String text = cursor.getString(colIndex);
    		((TextView)view).setText(text);
    	}

    	@Override
    	public View newView(Context context, Cursor cursor, ViewGroup parent) {
    		View newItemView = AndroidCloudNotesActivity.this.getLayoutInflater().inflate(R.layout.tasklist_view_item, null);
    		int index = cursor.getColumnIndex("name");
    		String text = cursor.getString(index);
    		((TextView)newItemView).setText(text);
    		return newItemView;
    	}
    	
		@Override
		protected void onContentChanged() {
			super.onContentChanged();
			
			Log.d(CloudNotesApp.TAG, "TaskListAdapter.onContentChanged");

			_cursor = getContentResolver().query(Uri.parse(TaskListProviderContract.URI),
					new String[] {TaskListProviderContract.COL_ID, TaskListProviderContract.COL_NAME},
					null, null, null);
			startManagingCursor(_cursor);
			changeCursor(_cursor);				
		}


    }
}